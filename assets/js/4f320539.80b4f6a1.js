"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1647],{5713(e,t,s){s.r(t),s.d(t,{default:()=>V});var i=s(6540),a=s(1656);class n{handle(e){console.error(e)}}const r="CanvicoEditor:";function o(e){return new Error(`${r} Required DOM element not found for selector: "${e}".`)}function h(e){return new Error(`${r} Element for selector "${e}" is not an <input type="file">.`)}function c(e){return new Error(`${r} Invalid file: ${e}`)}function l(e="File could not be read"){return new Error(`${r} Image load error: ${e}`)}class d{elements;resizeElements;cropElements;errorHandler;constructor(e,t){this.errorHandler=t,this.elements={container:this.queryAndValidate(e.containerSelector),imageFileInput:this.queryAndValidate(e.imageFileInputSelector,t=>{if("file"!==t.type)throw h(e.imageFileInputSelector)}),resetEditsButton:this.queryAndValidate(e.resetEditsButtonSelector),clearCanvasButton:this.queryAndValidate(e.clearCanvasButtonSelector),saveButton:this.queryAndValidate(e.saveButtonSelector)},this.resizeElements=this.initializeModuleElements(e.modules?.resize,"Resize",e=>{const t={widthInput:this.queryAndValidate(e.widthInputSelector),heightInput:this.queryAndValidate(e.heightInputSelector)};return e.lockAspectRatioSelector&&(t.lockAspectRatio=this.queryAndValidate(e.lockAspectRatioSelector)),t}),this.cropElements=this.initializeModuleElements(e.modules?.crop,"Crop",e=>({activateButton:this.queryAndValidate(e.activateButtonSelector),applyButton:this.queryAndValidate(e.applyButtonSelector)}))}queryAndValidate(e,t){const s=document.querySelector(e);if(!s)throw o(e);return t&&t(s),s}initializeModuleElements(e,t,s){if(e)try{return s(e)}catch(i){return console.warn(`DOM elements for ${t} module not found. The module will be disabled.`),void this.errorHandler.handle(i)}}}class u{name;eventHandlers=[];constructor(e){this.name=e}getName(){return this.name}destroy(){this.eventHandlers.forEach(({element:e,type:t,handler:s})=>{e.removeEventListener(t,s)}),this.eventHandlers=[]}addEventListener(e,t,s){e.addEventListener(t,s),this.eventHandlers.push({element:e,type:t,handler:s})}}class p extends u{widthInput;heightInput;lockAspectRatio;container;canvas;ctx;getCurrentImage;onRequestRedraw;onCanvasResized;errorHandler;isActive=!1;constructor(e,t){super("resize"),this.widthInput=e.widthInput,this.heightInput=e.heightInput,this.lockAspectRatio=e.lockAspectRatio,this.container=t.container,this.canvas=t.canvas,this.ctx=t.ctx,this.getCurrentImage=t.getCurrentImage,this.onRequestRedraw=t.onRequestRedraw,this.onCanvasResized=t.onCanvasResized,this.errorHandler=new n}init(){this.addEventListener(this.widthInput,"input",()=>this._updateCanvasAndInputs("width")),this.addEventListener(this.heightInput,"input",()=>this._updateCanvasAndInputs("height")),this.lockAspectRatio&&this.addEventListener(this.lockAspectRatio,"change",()=>this._updateCanvasAndInputs())}activate(){this.isActive=!0}deactivate(){this.isActive=!1}_updateCanvasAndInputs(e){try{if(!this.isActive)return;const t=this.getCurrentImage();if(!t)return;let s=parseInt(this.widthInput.value,10)||0,i=parseInt(this.heightInput.value,10)||0;if(this.lockAspectRatio?.checked){const a=t.width/t.height;"width"===(e||"width")?(i=s>0?Math.round(s/a):0,this.heightInput.value=i.toString()):(s=i>0?Math.round(i*a):0,this.widthInput.value=s.toString())}if(s<=0||i<=0)return;this._redrawCanvas(t,s,i)}catch(t){this.errorHandler.handle(t)}}_redrawCanvas(e,t,s){const i=this.canvas.width,a=this.canvas.height,n=this.container.clientWidth,r=this.container.clientHeight,o=Math.min(n/t,r/s,1),h=t*o,c=s*o;if(this.canvas.width=h,this.canvas.height=c,i>0&&a>0&&this.onCanvasResized){const e=h/i,t=c/a;this.onCanvasResized(e,t)}this.ctx.clearRect(0,0,h,c),this.ctx.drawImage(e,0,0,e.width,e.height,0,0,h,c),this.onRequestRedraw?.()}}var m=(e=>(e.NW="nw",e.NE="ne",e.SW="sw",e.SE="se",e))(m||{});class v extends u{canvas;ctx;applyButton;getCurrentImage;requestRedraw;onCropAppliedCallback;frameColor;outsideOverlayColor;HANDLE_SIZE=8;MIN_CROP_SIZE=2*this.HANDLE_SIZE;cropMode=!1;cropRect={x:0,y:0,w:0,h:0};dragging=!1;dragOffsetX=0;dragOffsetY=0;activeHandle=null;shiftPressed=!1;lastMouseX=0;lastMouseY=0;constructor(e,t){super("crop"),this.canvas=t.canvas,this.ctx=t.ctx,this.getCurrentImage=t.getCurrentImage,this.requestRedraw=t.requestRedraw,this.onCropAppliedCallback=t.onCropApplied,this.applyButton=e.applyButton,this.frameColor=t.frameColor||"red",this.outsideOverlayColor=t.outsideOverlayColor||"rgba(0, 0, 0, 0.2)"}init(){this.addEventListener(this.applyButton,"click",this._applyCrop)}destroy(){this.deactivate(),super.destroy()}activate(){this.enableCropMode()}deactivate(){this.disableCropMode()}isCropModeActive(){return this.cropMode}enableCropMode(){if(!this.getCurrentImage()||this.cropMode)return;this.cropMode=!0;const e=this.canvas.width,t=this.canvas.height;this.cropRect={x:e/4,y:t/4,w:e/2,h:t/2},this.shiftPressed=!1,this.canvas.addEventListener("mousedown",this._onMouseDown),this.canvas.addEventListener("mousemove",this._onMouseMove),window.addEventListener("mouseup",this._onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.requestRedraw?.()}disableCropMode(){this.cropMode&&(this.cropMode=!1,this.dragging=!1,this.activeHandle=null,this.canvas.removeEventListener("mousedown",this._onMouseDown),this.canvas.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("mouseup",this._onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.canvas.style.cursor="default",this.requestRedraw?.())}onKeyDown=e=>{"Shift"===e.key&&(this.shiftPressed=!0,this.dragging&&this._handleDrag(this.lastMouseX,this.lastMouseY))};_onKeyUp=e=>{"Shift"===e.key&&this.cropMode&&(this.shiftPressed=!1,this.dragging&&this._handleDrag(this.lastMouseX,this.lastMouseY))};_onMouseDown=e=>{if(!this.cropMode)return;const t=e.offsetX,s=e.offsetY;this.activeHandle=this._detectHandle(t,s),this.activeHandle&&(this.dragging=!0,"rect"===this.activeHandle&&(this.dragOffsetX=t-this.cropRect.x,this.dragOffsetY=s-this.cropRect.y))};_onMouseMove=e=>{if(this.lastMouseX=e.offsetX,this.lastMouseY=e.offsetY,this.cropMode&&this.dragging&&this.activeHandle)this._handleDrag(this.lastMouseX,this.lastMouseY);else if(this.cropMode){const t=this._detectHandle(e.offsetX,e.offsetY);this._updateCursor(t)}};_onMouseUp=()=>{!this.cropMode||!this.dragging||(this.dragging=!1,this.activeHandle=null,this._normalizeCropRect(),this.requestRedraw?.())};_handleDrag(e,t){let{x:s,y:i,w:a,h:n}=this.cropRect;if("rect"===this.activeHandle)s=e-this.dragOffsetX,i=t-this.dragOffsetY;else{switch(this.activeHandle){case"nw":a+=s-e,n+=i-t,s=e,i=t;break;case"ne":a=e-s,n+=i-t,i=t;break;case"sw":a+=s-e,n=t-i,s=e;break;case"se":a=e-s,n=t-i}if(this.shiftPressed){const e=Math.abs(a),t=Math.abs(n);e>t?n=(n<0?-1:1)*e:a=(a<0?-1:1)*t}}this.cropRect={x:s,y:i,w:a,h:n},this.requestRedraw?.()}_normalizeCropRect(){this.cropRect.w<0&&(this.cropRect.x+=this.cropRect.w,this.cropRect.w=Math.abs(this.cropRect.w)),this.cropRect.h<0&&(this.cropRect.y+=this.cropRect.h,this.cropRect.h=Math.abs(this.cropRect.h)),this.cropRect.w<this.MIN_CROP_SIZE&&(this.cropRect.w=this.MIN_CROP_SIZE),this.cropRect.h<this.MIN_CROP_SIZE&&(this.cropRect.h=this.MIN_CROP_SIZE),this.cropRect.x=Math.max(0,this.cropRect.x),this.cropRect.y=Math.max(0,this.cropRect.y),this.cropRect.x+this.cropRect.w>this.canvas.width&&(this.cropRect.w=this.canvas.width-this.cropRect.x),this.cropRect.y+this.cropRect.h>this.canvas.height&&(this.cropRect.h=this.canvas.height-this.cropRect.y)}_applyCrop=()=>{const e=this.getCurrentImage();if(!e||!this.cropMode||0===this.cropRect.w||0===this.cropRect.h)return void this.deactivate();const{x:t,y:s,w:i,h:a}=this._getVisualRect(),n=e.naturalWidth/this.canvas.width,r=e.naturalHeight/this.canvas.height,o=t*n,h=s*r,c=i*n,l=a*r;if(c<=0||l<=0)return console.error("Crop dimensions are invalid for applying crop."),void this.deactivate();const d=document.createElement("canvas");d.width=c,d.height=l;const u=d.getContext("2d");u?(u.drawImage(e,o,h,c,l,0,0,c,l),this.onCropAppliedCallback(d.toDataURL())):console.error("Failed to get 2D context for offscreen canvas")};drawOverlay(){if(!this.cropMode)return;const{x:e,y:t,w:s,h:i}=this._getVisualRect();this.ctx.save(),this.ctx.fillStyle=this.outsideOverlayColor,this.ctx.beginPath(),this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.rect(e,t,s,i),this.ctx.fill("evenodd"),this.ctx.strokeStyle=this.frameColor,this.ctx.lineWidth=2,this.ctx.strokeRect(e,t,s,i),this.ctx.fillStyle=this.frameColor;for(const a of Object.values(m)){const{x:e,y:t}=this._getVisualHandleCoord(a);this.ctx.fillRect(e-this.HANDLE_SIZE/2,t-this.HANDLE_SIZE/2,this.HANDLE_SIZE,this.HANDLE_SIZE)}this.ctx.restore()}_detectHandle(e,t){for(const r of Object.values(m)){const{x:s,y:i}=this._getVisualHandleCoord(r);if(Math.abs(e-s)<=this.HANDLE_SIZE&&Math.abs(t-i)<=this.HANDLE_SIZE)return r}const{x:s,y:i,w:a,h:n}=this._getVisualRect();return e>=s&&e<=s+a&&t>=i&&t<=i+n?"rect":null}_getVisualRect(){const{x:e,y:t,w:s,h:i}=this.cropRect;return{x:s>0?e:e+s,y:i>0?t:t+i,w:Math.abs(s),h:Math.abs(i)}}_getVisualHandleCoord(e){const{x:t,y:s,w:i,h:a}=this._getVisualRect();switch(e){case"nw":return{x:t,y:s};case"ne":return{x:t+i,y:s};case"sw":return{x:t,y:s+a};case"se":return{x:t+i,y:s+a}}}_updateCursor(e){this.canvas.style.cursor="rect"===e?"move":e?"crosshair":"default"}}class g{dom;canvas;ctx;initialImage;currentImage;modules=new Map;errorHandler;config;DEFAULT_MODULE=null;activeModuleName=null;constructor(e){if(this.config=e,this.errorHandler=new n,!window.FileReader)throw function(e){return new Error(`${r} Required browser feature not supported: ${e}.`)}("FileReader API is not supported by this browser.");this.dom=new d(e,this.errorHandler),[this.canvas,this.ctx]=this._initializeCanvas(),this._registerModules(),this._bindGlobalEvents()}_initializeCanvas(){const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error(`${r} 2D context is not supported by the browser.`);return this.dom.elements.container.appendChild(e),[e,t]}destroy(){this._setActiveModule(null),this.dom.elements.imageFileInput.replaceWith(this.dom.elements.imageFileInput.cloneNode(!0)),this.dom.elements.clearCanvasButton.replaceWith(this.dom.elements.clearCanvasButton.cloneNode(!0)),this.dom.elements.saveButton.replaceWith(this.dom.elements.saveButton.cloneNode(!0)),this.modules.forEach(e=>e.destroy()),this.modules.clear()}_resetImage(){this.initialImage&&(this.currentImage=this.initialImage,this._resetCanvasView(this.initialImage),this._setActiveModule(this.DEFAULT_MODULE))}_cleanAll(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=0,this.canvas.height=0,this.initialImage=void 0,this.currentImage=void 0,this.dom.resizeElements&&(this.dom.resizeElements.widthInput.value="",this.dom.resizeElements.heightInput.value="",this.dom.resizeElements.lockAspectRatio&&(this.dom.resizeElements.lockAspectRatio.checked=!1)),this.dom.elements.imageFileInput.value="",this._setActiveModule(this.DEFAULT_MODULE)}_saveImage(){if(!this.currentImage)return void this.errorHandler.handle(new Error(`${r} Cannot save because no image is loaded.`));const e=document.createElement("a"),t=this.dom.elements.imageFileInput.files?.[0],s=t?t.name.replace(/\.[^/.]+$/,""):"image";e.download=`${s}-edited.png`,e.href=this.canvas.toDataURL("image/png"),e.click()}_bindGlobalEvents(){this.dom.elements.imageFileInput.addEventListener("change",e=>this._loadImage(e)),this.dom.cropElements&&this.dom.cropElements.activateButton.addEventListener("click",()=>this.currentImage&&this._setActiveModule("crop")),this.dom.elements.resetEditsButton.addEventListener("click",()=>this._resetImage()),this.dom.elements.clearCanvasButton.addEventListener("click",()=>this._cleanAll()),this.dom.elements.saveButton.addEventListener("click",()=>this._saveImage())}_registerModules(){if(this.dom.resizeElements){const e=new p(this.dom.resizeElements,{container:this.dom.elements.container,canvas:this.canvas,ctx:this.ctx,getCurrentImage:()=>this.currentImage});this.modules.set("resize",e),this.DEFAULT_MODULE="resize"}if(this.dom.cropElements&&this.config.modules?.crop){const e=new v(this.dom.cropElements,{canvas:this.canvas,ctx:this.ctx,frameColor:this.config.modules.crop.frameColor,outsideOverlayColor:this.config.modules.crop.outsideOverlayColor,requestRedraw:()=>this._redraw(),getCurrentImage:()=>this.currentImage,onCropApplied:e=>this._handleCropApplied(e)});this.modules.set("crop",e)}this.modules.forEach(e=>e.init()),console.log(this.modules),this._setActiveModule(this.DEFAULT_MODULE)}_resetCanvasView(e){this.currentImage=e;const t=this.dom.elements.container.clientWidth,s=this.dom.elements.container.clientHeight,i=Math.min(t/e.width,s/e.height),a=e.width*i,n=e.height*i;this.canvas.width=a,this.canvas.height=n,this._redraw(),this.dom.resizeElements&&(this.dom.resizeElements.widthInput.value=Math.round(a).toString(),this.dom.resizeElements.heightInput.value=Math.round(n).toString())}_setActiveModule(e){let t=e;this.activeModuleName===e&&e!==this.DEFAULT_MODULE&&(t=this.DEFAULT_MODULE),this.activeModuleName!==t&&(this.activeModuleName=t,this.modules.forEach((e,t)=>{t===this.activeModuleName?e.activate():e.deactivate()}),this._redraw())}_loadImage(e){try{const t=e.target.files?.[0];if(!t)return;!function(e,t){const s=1024*t*1024,i=["image/jpeg","image/png","image/gif","image/webp"];if(!i.includes(e.type))throw c(`Unsupported file type. Supported types are: ${i.join(", ")}.`);if(e.size>s)throw c(`File is too large. Maximum size is ${t}MB.`)}(t,this.config.maxFileSizeMB||5);const s=new FileReader;s.onload=e=>{const t=new Image;t.onload=()=>{try{this.currentImage=t,this.initialImage=t,this._resetCanvasView(t)}catch(n){this.errorHandler.handle(n)}},t.onerror=()=>{this.errorHandler.handle(l("Error reading image file."))},t.src=e.target.result},s.onerror=()=>{this.errorHandler.handle(l("Error reading file with FileReader."))},s.readAsDataURL(t)}catch(t){this.errorHandler.handle(t)}}_handleCropApplied(e){const t=new Image;t.onload=()=>{this.currentImage=t,this._setActiveModule(this.DEFAULT_MODULE),this._resetCanvasView(t)},t.src=e}_redraw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentImage&&(this.ctx.drawImage(this.currentImage,0,0,this.currentImage.width,this.currentImage.height,0,0,this.canvas.width,this.canvas.height),this.activeModuleName&&this.modules.get(this.activeModuleName)?.drawOverlay?.())}}const w="demoContainer_ryNF",f="header_IBbT",_="headerTitle_aibS",I="headerDesc_xv6C",E="canvico-container_x67l",x="mainLayout_kTt3",y="toolsContainer_Wm_w",C="controlGroup_qXl2",R="groupLabel_pHDq",M="moduleSubGroup_neSd",A="subGroupLabel_CPSU",b="groupContent_oGMC",N="controlButton_Y_PR button button--primary",L="saveButton_BPe4 button button--primary",S="fileInputContainer_GBzB",k="fileInputLabel_ix1_ controlButton_Y_PR button button--primary",H="fileInput_s1VV",D="controlLabel_T4Fe",j="sizeInput_GXio",B="checkboxLabel_KO3V",z="checkboxInput_EVuY",F="customCheckbox_WTw0",O="separator_dsIg";var q=s(4848);function U(){return(0,i.useEffect)(()=>{if("undefined"!=typeof window)try{new g({containerSelector:`.${E}`,imageFileInputSelector:".input-upload-file",resetEditsButtonSelector:"#resetEdit",clearCanvasButtonSelector:"#cleanAll",saveButtonSelector:"#saveBtn",modules:{resize:{widthInputSelector:"#widthInput",heightInputSelector:"#heightInput",lockAspectRatioSelector:"#keepAspectRatio"},crop:{activateButtonSelector:"#cropBtn",applyButtonSelector:"#applyBtn",frameColor:"#d84cb9",outsideOverlayColor:"rgba(0,0,0,0.2)"}}})}catch(e){console.error("Failed to initialize CanvicoEditor:",e)}},[]),(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)("div",{className:w,children:[(0,q.jsxs)("header",{className:f,children:[(0,q.jsx)("h1",{className:_,children:"Canvico Editor"}),(0,q.jsx)("p",{className:I,children:"A simple and powerful in-browser image editor, built with TypeScript and Canvas API. Try it out below!"})]}),(0,q.jsxs)("main",{className:x,children:[(0,q.jsxs)("aside",{className:y,children:[(0,q.jsxs)("div",{className:C,children:[(0,q.jsx)("span",{className:R,children:"Main Actions"}),(0,q.jsxs)("div",{className:b,children:[(0,q.jsxs)("div",{className:S,children:[(0,q.jsx)("label",{className:k,children:"Choose File"}),(0,q.jsx)("input",{type:"file",accept:"image/*",className:`${H} input-upload-file`})]}),(0,q.jsx)("button",{id:"saveBtn",className:L,children:"Save"}),(0,q.jsx)("div",{className:O}),(0,q.jsx)("button",{id:"resetEdit",className:N,children:"Reset"}),(0,q.jsx)("button",{id:"cleanAll",className:N,children:"Clear All"})]})]}),(0,q.jsxs)("div",{className:C,children:[(0,q.jsx)("span",{className:R,children:"Tools"}),(0,q.jsxs)("div",{className:M,children:[(0,q.jsx)("h5",{className:A,children:"Cropping"}),(0,q.jsxs)("div",{className:b,children:[(0,q.jsx)("button",{id:"cropBtn",className:N,children:"Activate"}),(0,q.jsx)("button",{id:"applyBtn",className:N,children:"Apply"})]})]}),(0,q.jsxs)("div",{className:M,children:[(0,q.jsx)("h5",{className:A,children:"Resizing"}),(0,q.jsxs)("div",{className:b,children:[(0,q.jsx)("label",{htmlFor:"widthInput",className:D,children:"Width:"}),(0,q.jsx)("input",{type:"text",id:"widthInput",min:"1",className:j}),(0,q.jsx)("label",{htmlFor:"heightInput",className:D,children:"Height:"}),(0,q.jsx)("input",{type:"text",id:"heightInput",min:"1",className:j}),(0,q.jsxs)("label",{htmlFor:"keepAspectRatio",className:B,children:[(0,q.jsx)("input",{type:"checkbox",id:"keepAspectRatio",defaultChecked:!0,className:z}),(0,q.jsx)("span",{className:F}),(0,q.jsx)("span",{children:"Keep aspect ratio"})]})]})]})]})]}),(0,q.jsx)("div",{className:E})]})]})})}function V(){return(0,q.jsx)(a.A,{title:"Demo",description:"Live demo of Canvico Editor",children:(0,q.jsx)(U,{})})}}}]);